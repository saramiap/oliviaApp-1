// _journalLayout.scss
@import url('https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Shadows+Into+Light+Two&display=swap');

// --- Palette de Couleurs (valeurs hexadécimales directes) ---
$journal-bg: #FDF6E3;                     // Couleur crème/papier vieilli
$journal-lines: #D4C8B4;                  // Couleur des lignes du cahier
$journal-text-color: #4A3B31;             // Couleur d'encre foncée (marron/gris)
$journal-accent: #814CAF;                 // Ton violet pour les accents
$journal-accent-darker: #6A3D91;          // Pour hover sur $journal-accent
$journal-accent-lighter: #E8D9F2;   
$journal-accent-primary: #E8D9F2;       // Pour fond actif ou hover léger
$journal-history-bg: #F5EFDB;             // Fond pour la colonne historique
$journal-history-border: #EAE1CD;         // Bordure pour l'historique (plus foncée que le fond)
$journal-history-text: #5D5046;
$journal-history-text-light: #96897F;     // Texte plus clair pour dates, etc.
$journal-history-hover-bg: #EFE5CC;
$journal-history-title-border: #C9BEA9;   // Ligne pointillée sous le titre de l'historique
$journal-delete-btn-hover: #D32F2F;       // Rouge pour hover sur supprimer
$journal-delete-btn-bg-hover: #FEEFEE;    // Fond léger pour hover sur supprimer
$journal-input-area-bg: #F0EADC;          // Fond de la zone d'input (légèrement différent de l'historique)
$journal-textarea-border: #CBBFAC;        // Bordure pour textarea
$journal-button-disabled-bg: #BCA5D3;     // Accent plus clair pour bouton désactivé
$journal-nav-border: #EAE1CD; 
$chat-text-muted:#A8B6C1;
$journal-bg: #F0F4F8;                   // Fond papier très clair (bleu-gris)
$journal-lines: #DDE4EA;                // Lignes de cahier
$journal-text-color: #2C3A47;           // Couleur d'encre (bleu nuit)
$journal-accent: #82AAFF;               // Accent bleu clair du chat
$journal-accent-darker: #6C95E0;        // Hover
$journal-border-dotted: #A8B6C1;        // Bordure pointillée (gris-bleu)
$journal-spiral-bg: #EAEFF3;            // Fond de la zone de la spirale
$journal-spiral-shadow: #BFCAD4;        // Ombre des trous
$journal-tape-bg: rgba(130, 170, 255, 0.25); // Scotch transparent bleuté



.layout-mode-journal {
  .page-navigation {
    // Override des styles pour le mode journal
    padding: 0; // On gère le padding dans le composant interne
    
    // Sur Desktop, on s'assure que tout est aligné en haut
    @media(min-width: 768px) {
      align-items: stretch;
      justify-content: flex-start;
    }

    .journal-navigation-content {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;

      .journal-nav-header {
        display: flex;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid $journal-nav-border;
        flex-shrink: 0; // Empêche le header de se compresser
        
        .profile-avatar-display {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          object-fit: cover;
          margin-right: 1rem;
          border: 2px solid $journal-accent-primary;
        }

        h2 {
          font-size: 1.2rem;
          color: $journal-history-text-light;
          margin: 0;
          font-weight: 600;
        }
      }

      .journal-history-list {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem;

        .no-history-entries {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 2rem 1rem;
          color: $chat-text-muted;
          text-align: center;
          gap: 0.75rem;

          p { margin: 0; font-size: 0.9rem; }
        }

        ul {
          list-style: none;
          padding: 0;
          margin: 0;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .history-entry-item {
          padding: 0.85rem 1rem;
          border-radius: 8px;
          cursor: pointer;
          transition: background-color 0.2s;
          border-left: 4px solid transparent; // Pour l'indicateur actif
          
          &:hover {
            background-color: rgba($journal-history-text-light, 0.1);
          }

          &.active-session {
            background-color: rgba($journal-accent-primary, 0.2);
            border-left-color: $journal-accent-primary;
          }

          .history-entry-title {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: $journal-history-text-light;
            margin-bottom: 0.25rem;
          }

          .history-entry-date {
            display: block;
            font-size: 0.75rem;
            color: $chat-text-muted;
          }
        }
      }
    }
  }
}

// --- KEYFRAMES POUR L'ANIMATION DE FLIP ---

@keyframes page-turn-in-from-right {
  from {
    transform: rotateY(-90deg);
    opacity: 0.5;
  }
  to {
    transform: rotateY(0deg);
    opacity: 1;
  }
}

@keyframes page-turn-in-from-left {
  from {
    transform: rotateY(90deg);
    opacity: 0.5;
  }
  to {
    transform: rotateY(0deg);
    opacity: 1;
  }
}

.journal-layout {
   // Nécessaire pour que les transformations 3D des enfants fonctionnent
  perspective: 1500px; 
  position: relative; // Pour positionner les boutons de navigation
  height: 100%;
  width: 100%;
  display: flex;
  overflow: hidden;
  background-color: #EAEFF3;
}

// Contenu principal (la "page" du cahier)
.journal-page-column {
 
 flex-grow: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
  font-family: 'Kalam', cursive; // Police manuscrite pour les entrées
  color: $journal-text-color;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); // Ombre portée pour l'effet papier
  
  // Application des animations
  &.page-turn-next {
    transform-origin: left center; // Le livre tourne depuis la "reliure" gauche
    animation: page-turn-in-from-right 0.6s ease-in-out;
  }

  &.page-turn-prev {
    transform-origin: right center; // Le livre tourne depuis la "reliure" droite
    animation: page-turn-in-from-left 0.6s ease-in-out;
  }
}
// Boutons de navigation (flèches)
.journal-nav-button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 20;
  background-color: rgba(60, 60, 60, 0.3);
  color: white;
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 1; // Invisibles par défaut
  transition: opacity 0.3s ease, background-color 0.3s ease, transform 0.3s ease;
  backdrop-filter: blur(2px);

  &.prev {
    left: 1rem;
  }

  &.next {
    right: 1rem;
  }

  &:not(:disabled):hover {
    background-color: rgba(0, 0, 0, 0.6);
    transform: translateY(-50%) scale(1.1);
  }
  
  &:disabled {
    opacity: 0 !important; // Totalement invisible si désactivé
    cursor: not-allowed;
  }
}
.journal-layout:hover .journal-nav-button:not(:disabled) {
  opacity: 1;
}
.journal-notebook-paper {
 flex-grow: 1;
  background-color: $journal-bg;
  background-image: linear-gradient(to bottom, $journal-lines 1px, transparent 1px);
  background-size: 100% 2.2em;
  padding: 1.5rem 2rem 1.5rem 3.5rem; // Plus de padding à gauche pour la spirale !
  overflow-y: auto;
  position: relative; // Pour la spirale
  border: 2px dotted $journal-border-dotted;
  border-left: none; // La spirale remplace la bordure gauche
 // La spirale !
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: 2rem; // Largeur de la reliure
    background-color: $journal-spiral-bg;
    border-right: 1px solid $journal-lines;
    // Les trous de la spirale (magie des dégradés)
    background-image: radial-gradient(
      circle at 1rem 1rem, 
      transparent 0.4rem, 
      $journal-spiral-shadow 0.4rem, 
      $journal-spiral-shadow 0.5rem, 
      $journal-spiral-bg 0.5rem
    );
    background-size: 2rem 2rem;
    background-position: 0 0.5rem;
  }

  @media (min-width: 768px) {
    padding: 2rem 2.5rem; // Padding desktop
    font-size: 1.1em;
  }

  // Titre effet "scotché"
.notebook-title-wrapper {
  font-family: 'Gochi Hand', cursive; // Une police "doodle" pour le titre
  font-size: 2.5rem;
  text-align: center;
  padding: 0.5rem 1.5rem;
  background-color: #fff;
  display: inline-block;
  margin: 0 auto 1.5em auto;
  position: relative;
  transform: rotate(-1.5deg); // Légèrement penché
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  
  // Le scotch
  &::before, &::after {
    content: '';
    position: absolute;
    width: 4rem;
    height: 1.5rem;
    background-color: $journal-tape-bg;
    top: 50%;
    transform: translateY(-50%);
  }
  &::before { left: -2rem; transform: translateY(-50%) rotate(-15deg); }
  &::after { right: -2rem; transform: translateY(-50%) rotate(15deg); }
}

 .notebook-header .notebook-date {
  font-family: 'Kalam', cursive;
  font-weight: 700;
  text-align: left;
  padding-bottom: 0.5em;
  border-bottom: 1px solid $journal-lines;
}
// Ligne de séparation pour les nouvelles pages
.page-break-line {
  border: none;
  border-top: 1px dashed $journal-border-dotted;
  text-align: center;
  margin: 2.2em 0;
}

// === PIED DE PAGE & NOUVEAU BOUTON ===
.journal-page-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 1.5rem;
  background-color: $journal-spiral-bg; // Même fond que la spirale
  border-top: 1px solid $journal-lines;
  font-family: Arial, sans-serif;
  font-size: 0.85rem;
  color: $journal-text-color;

  .new-page-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: transparent;
    border: 1px solid $journal-accent;
    color: $journal-accent;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;

    &:hover {
      background-color: $journal-accent;
      color: white;
    }
  }
}

  .notebook-entry-saved {
    margin-bottom: 2.2em; // Alignement sur les lignes
    border-bottom: 1px dashed rgba($journal-lines, 0.7);
    padding-bottom: 1.1em; // Espace avant la prochaine entrée, aligné sur une ligne
    .entry-text-saved {
      margin: 0; white-space: pre-line;
      word-wrap: break-word; overflow-wrap: break-word; // Assure que le texte ne déborde pas
    }
    .entry-meta-saved {
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.75em; color: $journal-history-text-light; margin-top: 0.5em;
      font-family: Arial, sans-serif; line-height: 1.4; // Rétablir line-height pour non-manuscrit
      .delete-entry-btn {
        background: none; border: none; color: $journal-history-text-light; cursor: pointer;
        font-size: 1em; padding: 0.2em;
        &:hover { color: $journal-delete-btn-hover; background-color: $journal-delete-btn-bg-hover; border-radius: 50%;}
      }
    }
  }

  .notebook-live-entry {
    min-height: 4.4em; // Au moins 2 lignes visibles
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word; // Assure que le texte ne déborde pas
  }
}

// Zone d'input en bas
.journal-input-area {
  padding: 1rem 1.5rem;
  border-top: 1px solid $journal-history-border;
  background-color: $journal-input-area-bg;
  display: flex;
  align-items: flex-end; // Aligne verticalement si textarea grandit
  flex-shrink: 0;

  .journal-textarea {
    flex-grow: 1;
    padding: 0.75rem 1rem;
    border: 1px solid $journal-textarea-border;
    border-radius: 6px;
    font-family: Arial, sans-serif;
    font-size: 1rem;
    background-color: #FFFFFF;
    color: #222222;
    resize: none;
    min-height: 50px;     // Hauteur minimale
    max-height: 120px;    // Limite la hauteur avant scroll interne
    line-height: 1.5;
    margin-right: 1rem;
    overflow-y: auto;     // Active le scroll interne si dépasse max-height
    width: 100%;          // Pour s'assurer qu'il ne dépasse pas
    box-sizing: border-box;
    &:focus {
        outline: none;
        border-color: $journal-accent;
        box-shadow: 0 0 0 2px rgba($journal-accent, 0.3);
    }
  }

  .journal-add-entry-btn {
    background-color: $journal-accent;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.7rem 1.1rem; // Ajusté pour mieux correspondre à hauteur textarea
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color 0.2s;
    font-weight: 500;
    white-space: nowrap;
    min-height: 50px; // Hauteur fixe pour s'aligner
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;

    &:hover { background-color: $journal-accent-darker; }
    &:disabled { background-color: $journal-button-disabled-bg; cursor: not-allowed; }
  }
}